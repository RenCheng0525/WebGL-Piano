```markdown
# WebGL Piano

**Generated by Claude with prompts only, no manual code editing. Took 2 hours.**

---

## Live Demo

Check out the live demo here: [https://rencheng0525.github.io/WebGL-Piano/](https://rencheng0525.github.io/WebGL-Piano/)

---

## Overview

WebGL Piano is a cutting-edge, interactive piano application that combines 3D visualization with high-quality audio playback. Built with [Three.js](https://threejs.org/) for rendering and [Tone.js](https://tonejs.github.io/) for audio synthesis, this project also features a custom MIDI parser that loads and plays MIDI files, synchronizing visual and audio effects seamlessly.

---

## Key Features

1. **3D Visualization with Three.js**
   - **Scene Setup:**  
     A Three.js scene is created with a black background, a perspective camera, and a WebGL renderer that supports realistic shadow effects.
   - **OrbitControls Integration:**  
     Users can rotate, zoom, and pan the camera using OrbitControls, which includes smooth damping for natural interaction.
   - **Lighting Design:**  
     Ambient, spot, and directional lights are utilized to cast realistic shadows and enhance the 3D appearance of the piano scene.
   - **Piano Keys and Glow Effects:**  
     - White and black piano keys are generated using BoxGeometry and are mapped to corresponding MIDI note numbers.
     - Each key has an associated glow mesh that highlights and glows when activated, providing clear visual feedback.

2. **MIDI Parsing and Event Scheduling**
   - **Custom MIDI Parser:**  
     - A custom `MidiParser` class reads and parses raw MIDI file data, handling headers, tracks, delta times, and meta events (such as tempo changes).
     - It extracts Note On, Note Off, and Tempo events, calculating the playback time for each event.
   - **Event Scheduling:**  
     - MIDI delta times and tempo data are converted into real-time (seconds), and events are sorted to ensure they play in the correct order.

3. **Audio Playback with Tone.js**
   - **Sampler Instrument:**  
     - Tone.js's Sampler loads piano samples (e.g., C4, D#4, F#4, A4) from an online resource.
     - A reverb effect is added to provide depth and a spacious audio experience.
   - **Note Triggering:**  
     - Based on the parsed MIDI events, Tone.js is used to trigger note attacks (`triggerAttack`) and releases (`triggerRelease`).
     - The MIDI velocity values dynamically adjust the volume, ensuring expressive and dynamic sound playback.

4. **User Interaction and Controls**
   - **Playback Controls:**  
     - Play, Pause, and Stop buttons allow users to control MIDI playback.
   - **Progress Bar:**  
     - A progress bar displays the current playback time relative to the total duration.
     - Users can click or drag on the progress bar to jump to different parts of the MIDI file.
   - **Mouse and Keyboard Interaction:**  
     - Raycasting is used to detect mouse hover over the 3D keys, and clicking on a key triggers the corresponding note along with visual animations.

5. **Visual and Audio Synchronization**
   - **Animation Loop:**  
     - A continuous animation loop updates the 3D scene and playback progress, keeping visual effects in sync with the MIDI audio.
   - **Key Press Animations:**  
     - Keys smoothly depress and rebound to simulate a real piano's tactile response, with simultaneous material changes and glow effects to indicate activation.

6. **Responsive Design and Aesthetic Interface**
   - **Modern CSS Styling:**  
     - The interface features a dark-themed, minimalist design with sleek control buttons and a progress bar.
   - **Adaptive Layout:**  
     - The application listens for window resize events to adjust the camera's aspect ratio and renderer dimensions, ensuring proper display on all devices.

7. **Modular Architecture and Extensibility**
   - **Separation of Concerns:**  
     - The project cleanly separates MIDI parsing, audio playback, 3D rendering, and user interactions, making it easier to maintain and extend.
   - **Future Enhancements:**  
     - The design allows for the easy addition of more instruments, audio effects, or additional MIDI event handling features.

---

## How to Use

1. **Prerequisites:**
   - A modern web browser that supports WebGL.
   - Internet access to load external libraries (Three.js, Tone.js) and audio sample files.

2. **Steps:**
   - Open the project in your web browser to view the 3D piano scene.
   - Click the music note button to upload a MIDI file (`.mid` or `.midi`).
   - Once the file is loaded, the filename is displayed and the play button is enabled.
   - Click the play button to start MIDI playback, and use the progress bar to monitor or jump to a specific point in the track.
   - You can also interact directly with the 3D piano keys by clicking on them to trigger notes.

3. **Development and Customization:**
   - The project is modular, allowing for modifications in MIDI parsing, audio playback, or 3D rendering based on your needs.
   - Additional instruments or audio effects can be added by extending the `samplers` object.
   - Adjust CSS and Three.js parameters to further customize the visual appearance and user experience.

---

## Conclusion

WebGL Piano combines state-of-the-art 3D visualization with high-quality audio playback to deliver an immersive online piano experience. It demonstrates the powerful capabilities of Three.js and Tone.js, offering a robust foundation for further musical and interactive enhancements.

Feel free to fork, star, or submit issues and pull requests to help improve the project!
```